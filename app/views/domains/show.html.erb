<h1><%= @domain.domain %></h1>

<%= link_to "Back", domains_path %>

<p id="notice"><%= notice %></p>

<ul>
  <li>Mailboxes: <%= @domain.rel_mailboxes.count %> / <%= @domain.mailboxes %></li>
  <li>Aliases: <%= @domain.pure_aliases.count %> / <%= @domain.aliases %></li>
  <li>Quota (MB): <%= @domain.maxquota_str %></li>
  <li>Active: <%= @domain.active %></li>
</ul>

<h3>Mailbox</h3>

<%= link_to "new mailbox", new_domain_mailbox_path(@domain),
            role: "button", class: "btn btn-primary btn-lg" %>

<table class="table">
  <thead class="thead-dark">
  <tr>
    <th>Mailbox</th>
    <th>To</th>
    <th>Name</th>
    <th>Quota (MB)</th>
    <th>Active</th>
    <th>Alias</th>
    <th>Edit</th>
    <th>Delete</th>
    <th>Modified</th>
  </tr>
  </thead>
  <tbody>
  <% @domain.rel_mailboxes.includes(:alias).each do |m| %>
    <% tr_class = m.active? ? "" : "table-secondary" %>
    <tr class="<%= tr_class %>">
      <td><%= m.username %></td>
      <td>
        <% m.alias.gotos.each do |g| %>
        <%= g %><br>
        <% end %>
      </td>
      <td><%= m.name %></td>
      <td><%= m.quota_str %></td>
      <td><%= m.active %></td>
      <td><%= link_to "alias", edit_domain_alias_path(@domain, m.alias),
                      role: "button", class: "btn btn-info btn-sm" %></td>
      <td><%= link_to "Edit", edit_domain_mailbox_path(@domain, m),
                      role: "button", class: "btn btn-info btn-sm" %></td>
      <td><%= link_to "Delete", domain_mailbox_path(@domain, m), method: :delete,
                      data: { confirm: 'Are you sure?' },
                      role: "button", class: "btn btn-secondary btn-sm" %></td>
      <td><%= l m.modified %></td>
    </tr>
  <% end %>
  </tbody>
</table>

<h3>Alias</h3>

<%= link_to "new alias", new_domain_alias_path(@domain),
            role: "button", class: "btn btn-primary btn-lg" %>

<table class="table">
  <thead class="thead-dark">
  <tr>
    <th>Alias</th>
    <th>To</th>
    <th>Active</th>
    <th>Edit</th>
    <th>Delete</th>
    <th>Modified</th>
  </tr>
  </thead>
  <tbody>
  <% @domain.pure_aliases.each do |a| %>
    <% tr_class = a.active? ? "" : "table-secondary" %>
    <tr class="<%= tr_class %>">
      <td><%= a.address %></td>
      <td>
        <% a.gotos.each do |g| %>
          <%= g %><br>
        <% end %>
      </td>
      <td><%= a.active %></td>
      <td><%= link_to "Edit", edit_domain_alias_path(@domain, a),
                      role: "button", class: "btn btn-info btn-sm" %></td>
      <td><%= link_to "Delete", domain_alias_path(@domain, a), method: :delete,
                      data: { confirm: 'Are you sure?' },
                      role: "button", class: "btn btn-secondary btn-sm" %></td>
      <td><%= l a.modified %></td>
    </tr>
  <% end %>
  </tbody>
</table>